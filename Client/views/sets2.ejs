<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin menu</title>

    <!-- ** Plugins Needed for the Project ** -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="../plugins/bootstrap/bootstrap.min.css" />

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="../../css/navadmin.css" />

    <!--Favicon-->
    <link rel="shortcut icon" href="../favicon.ico" />
    <link rel="icon" type="image/png" href="../../images/logo-backup2.png" />

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap');
    </style>
    <style>
    body{
      font-family: 'Roboto', sans-serif;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      color: #212529!important;
      background-color: #fff;
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
    }
    h1{
      color: black;
      line-height: normal;
      text-align: center;
      font-weight: 400;
      font-size: 24px;
    }
    .main{
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .gn-menu-main{
      flex: 1;
    }
    .header{
      display: flex;
      background-color: SlateBlue;
      justify-content: center;
      margin-top: 60px;
      flex: 1;
    }
    .page{
      display: flex;
      flex-direction: column;
      flex: 10;
    }
    .pageTop{
      display: flex;
      justify-content: center;
      align-content: center;
      flex: 1;
    }
    .pageCenter{
      flex: 2;
    }
    .pageBottom{
      flex: 6;
    }
    .searchBar{
      display: flex;
      /* border: 1px solid #ced4da; */
      background-color: #fff;
      align-items: center;
      border-radius: 30px;
      width: 33vw;
      height: 37px;
    }
    .searchIcon{
      font-size: 20px !important;
      margin-left: 6vw;
      cursor: pointer;
    }
    .searchInput{
      margin-left: 10px;
      width: 70%;
    }
    .searchInput > input[type="text"]{
      border: none;
      height: 35px;
      font-size: 16px;
    }
    .searchInput > input:focus{
      outline: none;
    }
    input, label{
      margin: 5px;
      color: #212529;
    }
    form {
      padding: 0;
      box-shadow: none;
      background: inherit;
    }
    .btn{
      background-color: dodgerblue;
      margin: 15px 15px 15px 5px;
    }
    .bg-light {
      background-color: #f8f9fa!important;
    }
    </style>
  </head>
  <body>
    <div class="main">
      <% include ../views/partials/adminpanel %>
      <div class="header">
        <header>
          <h1>Manage Multi Set Contests<br><span style="color: white;">Add Sets</span></h1>
        </header>
      </div>
      
      <div class="page">
        <div class="pageTop p-3 m-2 row">
          <div class="searchBar border">
            <div class="searchInput">
              <input
                class=""
                placeholder="Search contest with contest id.."
                type="text"
                id="contestId"
              >
            </input>
            </div>
            <div class="searchIcon" onclick="getSubmission()">
              <i class="fa fa-search"></i>
            </div>
          </div>
        </div>

        <div class="pageCenter bg-light p-3 m-2 row border">
          <form
            method="POST"
            id="form1"
          >
            <label id="setNumber">Add Question's to Set&nbsp;</label>
            <input 
              class="form-control"
              placeholder="Enter question id's seperated by comma..";
              type="text"
              name="questionIdsString"
            >
            </input>
            <textarea
              type="hidden"
              name="token"
              id="token2"
              value="<%= token %>"
              style="display: none"
            ></textarea>
            <button class="btn btn-primary" type="submit">Add Set</button>
          </form>
        </div>

        <div class="pageBottom bg-light p-3 m-2 row border">
          <div id="sets"></div>
        </div>
      </div>
    </div>
    <!-- /container -->

    <!-- Ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- jQuery -->
    <script src="../plugins/jQuery/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="../plugins/bootstrap/bootstrap.min.js"></script>
    <!-- Side Bar -->
    <script src="/adminjs/classie.js"></script>
    <script src="/adminjs/gnmenu.js"></script>
    <script>
      new gnMenu(document.getElementById("gn-menu"));
    </script>
    <script>
      document.getElementById("token2").value = "<%= token %>";
    </script>

<script>
  function getSubmission() {
    let contestId = document.getElementById("contestId").value;
    
    if(contestId === "") return false;

    $.ajax({
      url: "<%=data.serverurl%>" + "/contests/" + contestId,
      type: "GET",
      async: true,
      headers: {
        authorization: "<%= token %>",
      },
      success: function (data) {
        if (data.length > 0) {
          document.getElementById("form1").action
            = "<%= data.serverurl %>/questionIds/" + data[0].contestId;
          let sets = "";

          for(let i=data[0].sets.length-1; i>=0; i-- ) {
            sets += "<p>Set " + (i+1).toString() + "&ensp;--&emsp;"+ (data[0].sets[i]).toString().split(",").join(" / ") +"</p></br>"
          }
          
          document.getElementById("sets").innerHTML = sets;
          let str = document.getElementById("setNumber").innerText.substr(0,22);
          document.getElementById("setNumber").innerHTML = str + (data[0].sets.length+1).toString() + ":";
        }
        else {
          document.getElementById("sets").innerHTML = "<h3>Contest not found!</h3>";
        }
      }
    });
  }
  </script>
  </body>
</html>
